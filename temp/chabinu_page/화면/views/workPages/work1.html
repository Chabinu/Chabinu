<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>차비누 매니저</title>

  <!-- BootStrap v5.1 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  
  <!-- <link rel="stylesheet" href="/stylesheets/commonStyle.css"> -->
  <!-- <link rel="stylesheet" href="../../public/stylesheets/style.css"> -->

  <link rel="stylesheet" href="../../public/stylesheets/commonStyle.css">
  <link rel="stylesheet" href="../../public/stylesheets/manager.css">


  <style>

    .deleteImg {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: rgba(50, 50, 50, 0.2);
      display: inline-block;
      width: 20px;
      height: 20px;
      text-align: center;
      line-height: 15px;
      font-weight: bold;
      border: none;
      border-radius: 50%;
      cursor: pointer;
    }

    .deleteImg:hover {
      background-color: rgba(50, 50, 50, 0.3);
    }

    .boardImg {
      cursor: pointer;
      width: 200px;
      height: 200px;
      border: 1px solid #ced4da;
      position: relative;
    }

    .thubnail {
      width: 300px;
      height: 300px;
    }

    .boardImg>img {
      max-width: 100%;
      max-height: 100%;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      margin: auto;
    }

    .insert-label {
      display: inline-block;
      width: 80px;
      line-height: 40px
    }

    #fileArea {
      display: none;
    }

    .boardImg a{
      position : absolute;
      bottom: 0;
      right: 0;
    }

  </style>


</head>
<body>

  <div class="container-fluid no-padding no-margin vh-100" style="display: flex;">

    <!-- navbar 헤더 -->
    <nav class="navbar">
      
      <!-- navbar 회사로고 -->
      <div class="navbarHeader">
        <div class="navbar__logo">
          <a href="mainPage.html">CHABINU</a>
        </div>
  
        <a href="#" class="navbar__toggleBtn">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M24 6h-24v-4h24v4zm0 4h-24v4h24v-4zm0 8h-24v4h24v-4z" fill="#FDFDFD"/></svg>
        </a>
      </div>

      <!-- navbar 메뉴 -->
      <ul class="navbar__menu">
        <li><a href="">홈으로</a></li>
        <li><a href="">새작업</a></li>
        <li><a href="">작업중</a></li>
        <li><a href="">작업완료</a></li>
        <li><a href="loginPage.html">로그아웃</a></li>
      </ul>

    </nav>

    <!-- 본문 내용 -->
    <div class="mainContainer" style="width: 100%; height: 100%; border: 1px solid black; height: 100%;">


      <div class="photoInputArea" style="margin: auto; display: flex; flex-wrap: wrap;">

        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        <div class="beforePhoto">
          <img src="https://via.placeholder.com/150" alt="샘플이미지">
        </div>
        
      </div>


    </div>


    <!-- 세차 상세 페이지 (사진 찍기) -->

    <!-- 사진 영역 -->
    <div class="photoArea" style="padding-top: 60px;">

      <!-- 세차 전 사진 -->
      <div class="">

        <h2 class="h2">작업 전 이미지 업로드</h2>

        <!-- 업로드 이미지 미리보기 -->
        <!-- ajax -->
        <div class="form-inline mb-2">

					<label class="input-group-addon mr-3 insert-label">전측면</label>

					<div class="mx-auto boardImg">
						<img>
            <!-- 취소 버튼 -->
						<span class="deleteImg">x</span>
					</div>
        </div>

        
        <div id="fileArea">
          <!-- 최대 8장 -->
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,0)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,1)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,2)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,3)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,4)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,5)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,6)"> 
					<input type="file" name="images" capture="camera" accept="image/*" onchange="loadImg(this,7)"> 
				</div>

        <button class="btn btn-primary">저장</button>

      </div>

      <!-- 다중 미리보기 영역 -->
      <div class="d-flex container" style="border: 1px solid black; padding: 10px;">

        <div class="carImg" style="width: 16rem; height: 9rem;">
          <img src="../../public/images/샘플이미지1.jpg" style="max-width:100%; max-height: 100%;">
        </div>

      </div>

    </div>

  













  </div>

  <!-- BootStrap v5.1 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <!-- User Script -->
  <script src="../../public/js/main.js"></script>
  <!-- <script src="../../public/js/work/work1.js"></script> -->


  <!-- inline script 삭제예정 -->
  <script>
    $(function() {
      $(".boardImg").on("click", function() {
        var index = $(".boardImg").index(this);
            // 현재 클릭된 요소가 .boardImg 중 몇 번째 인덱스인지 반환



        $("[type=file]").eq(index).click();
        // 타입이 file인 요소 중 몇번째 인덱스 요소를 선택하여 클릭해라
      });

    });    

    // 파일을 선택한 경우 선택된 input 요소를 복제해서 저장하는 용도의 객체(백업)
    const fileClone = {}

    // x버튼이 눌러서 삭제된 이미지 레벨을 저장할 배열
    // -> 배열을 input 태그 value로 추가하면 'a, b, c, ...' 형태의 문자열로 변환됨
    const deleteImages = [] //비어있는 배열

    // 각각의 영역에 파일을 첨부 했을 경우 미리 보기가 가능하도록 하는 함수
    function loadImg(input, num) {
      // 매개변수 input == 클릭된 input 요소

      // 파일이 선택된 경우 true
      if (input.files && input.files[0]) {

        fileClone[num] = $(input).clone() // 백업 객체에 복제본 추가

        // deleteImages 배열에 num값과 같은 번호가 존재하는지 확인
        if(deleteImages.indexOf(num) != -1){ //존재하는 경우
          // 배열.splice(시작 인덱스, 제거할 수) : 배열 내 시작 인데스 부터 지정된 개수 만큼 요소 삭제
          deleteImages.splice(deleteImages.indexOf(num), 1)
        }

        var reader = new FileReader();
        // 자바스크립트 FileReader
        // 웹 애플리케이션이 비동기적으로 데이터를 읽기 위하여 읽을 파일을 가리키는 File 혹은 Blob객체를 이용해 파일의 내용을 읽고 사용자의 컴퓨터에 저장하는 것을 가능하게 해주는 객체


        // 선택된 파일 읽기 시작
        reader.readAsDataURL(input.files[0]);
        // FileReader.readAsDataURL()
        // 지정된 내용을 읽기 시작합니다. Blob완료되면 result속성 data:에 파일 데이터를 나타내는 URL이 포함 됩니다.

        // FileReader.onload
        // load 이벤트의 핸들러. 이 이벤트는 읽기 동작이 성공적으로 완료 되었을 때마다 발생합니다.

        // 다 읽은 경우
        reader.onload = function(e) {
          //console.log(e.target.result);
          // e.target.result
          // -> 파일 읽기 동작을 성공한 객체에(fileTag) 올라간 결과(이미지 또는 파일)

          $(".boardImg").eq(num).children("img").attr("src", e.target.result);
        }

      }else{
        console.log("취소 클릭함");

        // 취소가 실행된 input 태그 앞에 백업해둔 복제본을 추가
        $(input).before(fileClone[num].clone())
        // -> 원본 복제본의 복제본을 만들어 삽입

        $(input).remove() // 원본 삭제

        // innerHTML, html()
        // -> 작성된 문자열을 HTML Parser를 이용해서 해석 후 화면에 반영 
        // -> 문자열 내부에 요소가 있는지 처음에 모른다
        // -> 읽을 때 마다 같은 문장이라도 새로운 요소로 인식한다.
        // innerHTML = "안녕?"
        // innerHTML = "<h1>안녕?<h1>"
        // createElement("태그명"), $("<태그명>"), 얻어온 요소
        // == DOM 요소
        // -> 화면상에는 동일한 DOM 요소가 중복 존재할 수 없다.

        // 공통점 : 화면에 요소를 추가할 수 있다.

      }
    }


    // 이미지에 있는 X 버튼을 눌렀을 때의 동작
    $(".deleteImg").on("click", function(e){
      // 매개변수 e : 이벤트 발생 객체(이벤트에 관련된 모든 정보를 담고 있음)

      e.stopPropagation(); // 이벤트 버블링(감싸고 있는 요소에 이벤트가 전파 되는 것)
                // 멈춤
      $(this).prev().removeAttr("src") // 미리보기 이미지 삭제

      // 클릭된 x 버튼의 인덱스와
      // 같은 인덱스에 위치한 input type="file" 요소의 value를 초기화
      const index = $(this).index(".deleteImg")
      $("input[name=images]").eq(index).val("")
      // deleteImages 배열에 같은 이미지 레벨이 없으면
      if(deleteImages.indexOf(index) == -1){
        // deleteImages 배열에 삭제된 이미지의 레벨을 추가
        deleteImages.push(index)

      }

    });

  </script>


</body>
</html>